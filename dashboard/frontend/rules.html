<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Rules - WAF Dashboard</title>
    <link rel="stylesheet" href="assets/css/rules.css">    
</head>
<body>
     <div class="container">
        <!-- ========== SIDEBAR ========== -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>
                    <span>üõ°Ô∏è</span>
                    <span>Automated WAF</span>
                </h2>
                <p>Security Dashboard</p>
            </div>
            <nav>
                <a href="index.html" class="active">
                    <span class="icon">üìä</span>
                    <span>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</span>
                </a>
                <a href="logs.html">
                    <span class="icon">üìù</span>
                    <span>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ</span>
                </a>
                <a href="rules.html">
                    <span class="icon">‚öôÔ∏è</span>
                    <span>‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏é</span>
                </a>
                <!-- <a href="alerts.html">
                    <span class="icon">üîî</span>
                    <span>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span>
                </a>
                <a href="#" class="separator">
                    <span class="icon">ü§ñ</span>
                    <span>‡∏Å‡∏é‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞‡∏à‡∏≤‡∏Å AI/ML</span>
                </a>
                <a href="#">
                    <span class="icon">üîß</span>
                    <span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</span>
                </a>
                <a href="#">
                    <span class="icon">üìÑ</span>
                    <span>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>
                </a>
                <a href="#">
                    <span class="icon">üé®</span>
                    <span>‡∏ò‡∏µ‡∏°/‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</span>
                </a>
                <a href="#">
                    <span class="icon">üë•</span>
                    <span>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</span>
                </a> -->
            </nav>
        </div>
        
        <!-- Main Content -->
        <div class="main">
            <div class="header">
                <h1>‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏é (Custom Rules)</h1>
                <button class="btn btn-primary" onclick="openModal()">
                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏é‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>
            
            <div class="rules-table">
                <table id="rulesTable">
                    <thead>
                        <tr>
                            <th>Rule ID</th>
                            <th>Variable</th>
                            <th>Operator</th>
                            <th>Severity</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å API -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏° Rule -->
    <div class="modal" id="ruleModal">
        <div class="modal-content">
            <h2 style="margin-bottom: 20px;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏é‡πÉ‡∏´‡∏°‡πà</h2>
            <form id="ruleForm">
                <div class="form-group">
                    <label>Rule ID</label>
                    <input type="text" name="id" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 999001">
                </div>
                
                <div class="form-group">
                    <label>Variable</label>
                    <select name="variable">
                        <option value="REQUEST_URI">REQUEST_URI</option>
                        <option value="ARGS">ARGS</option>
                        <option value="REQUEST_HEADERS">REQUEST_HEADERS</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Operator (Pattern)</label>
                    <input type="text" name="operator" required placeholder="‡πÄ‡∏ä‡πà‡∏ô @rx .*admin.*">
                </div>
                
                <div class="form-group">
                    <label>Severity</label>
                    <select name="severity">
                        <option value="CRITICAL">Critical</option>
                        <option value="HIGH">High</option>
                        <option value="MEDIUM">Medium</option>
                        <option value="LOW">Low</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Message</label>
                    <textarea name="message" required placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏é‡∏ô‡∏µ‡πâ"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button type="button" class="btn" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Rules
        async function loadRules() {
            const res = await fetch('/api/rules/');
            const data = await res.json();
            
            const tbody = document.querySelector('#rulesTable tbody');
            tbody.innerHTML = '';
            
            data.rules.forEach(rule => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${rule.id}</td>
                    <td>${rule.variable}</td>
                    <td>${rule.operator}</td>
                    <td><span class="severity ${rule.severity.toLowerCase()}">${rule.severity}</span></td>
                    <td class="actions">
                        <button class="btn-delete" onclick="deleteRule('${rule.id}')">‡∏•‡∏ö</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° Rule
        document.getElementById('ruleForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            await fetch('/api/rules/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            closeModal();
            loadRules();
        });
        
        // ‡∏•‡∏ö Rule
        async function deleteRule(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏é‡∏ô‡∏µ‡πâ?')) {
                await fetch(`/api/rules/${id}`, { method: 'DELETE' });
                loadRules();
            }
        }
        
        function openModal() {
            document.getElementById('ruleModal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('ruleModal').classList.remove('active');
        }
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≠‡∏ô page load
        loadRules();
    </script>
</body>
</html>
